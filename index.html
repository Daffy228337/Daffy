<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Автораспределение заказов</title>
    <!-- Подключаем Яндекс Maps API -->
    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&amp;apikey=0f2d1024-aa27-4ceb-b1cc-284236a7812d
" type="text/javascript"></script>
    <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        #addCourier, #removeCourier, #createOrder, #assignOrder {
            margin: 10px;
            padding: 5px 10px;
        }
        #orderLog, #assignmentLog {
            margin: 10px;
            padding: 5px;
            border: 1px solid #ccc;
            height: 100px;
            overflow-y: scroll;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <button id="addCourier">Добавить курьера</button>
    <button id="removeCourier">Убрать курьера</button>
    <button id="createOrder">Создать заказ</button>
    <button id="assignOrder">Назначить заказ</button>

    <div id="orderLog">Лог заказов:</div>
    <div id="assignmentLog">Лог назначений:</div>

    <script>
    ymaps.ready(init);
    function init() {
        var myMap = new ymaps.Map("map", {
            center: [48.714325, 44.518758], // Координаты Волгограда
            zoom: 12
        });

        var restaurant = new ymaps.Placemark([48.714325, 44.518758], {
            hintContent: 'Ресторан',
            balloonContent: 'Рабоче-Крестьянская ул., 9 Б, Волгоград'
        }, {
            preset: 'islands#redIcon'
        });
        myMap.geoObjects.add(restaurant);

        var sectorPolygons = [];
        var sectorColors = ['#FF6347', '#4682B4', '#32CD32', '#FFD700']; // Tomato, SteelBlue, LimeGreen, Gold
        var sectorCoords = [
            [[48.72, 44.50], [48.72, 44.53], [48.70, 44.53], [48.70, 44.50]], // Сектор А
            [[48.70, 44.50], [48.70, 44.53], [48.68, 44.53], [48.68, 44.50]], // Сектор Б
            [[48.70, 44.53], [48.70, 44.56], [48.68, 44.56], [48.68, 44.53]], // Сектор В
            [[48.72, 44.53], [48.72, 44.56], [48.70, 44.56], [48.70, 44.53]]  // Сектор Г
        ];
        sectorCoords.forEach(function(coords, index) {
            var polygon = new ymaps.Polygon([coords], {
                hintContent: 'Сектор ' + String.fromCharCode(65 + index)
            }, {
                fillColor: sectorColors[index],
                fillOpacity: 0.6,
                strokeColor: '#000000',
                strokeWidth: 2
            });
            myMap.geoObjects.add(polygon);
            sectorPolygons.push(polygon);
        });

        var couriers = [];
        var orders = [];

        document.getElementById('addCourier').onclick = function() {
            couriers.push({ id: couriers.length + 1, orders: [] });
        };

        document.getElementById('removeCourier').onclick = function() {
            if (couriers.length > 0) {
                couriers.pop();
            }
        };

        document.getElementById('createOrder').onclick = function() {
            var randomSectorIndex = Math.floor(Math.random() * sectorPolygons.length);
            var randomSector = 'Сектор ' + String.fromCharCode(randomSectorIndex + 65);
            var order = {
                id: orders.length + 1,
                sector: randomSectorIndex,
                time: new Date().toLocaleTimeString('ru-RU'),
                description: 'Заказ ' + (orders.length + 1) + ' ' + randomSector + ' ' + new Date().toLocaleTimeString('ru-RU')
            };
            orders.push(order);
            addOrderToMap(randomSectorIndex);
        };

        document.getElementById('assignOrder').onclick = function() {
            if (orders.length > 0 && couriers.length > 0) {
                var orderToAssign = orders.shift();
                var assignedCourier = findLeastBusyCourier(orderToAssign.sector);
                if (assignedCourier) {
                    assignedCourier.orders.push(orderToAssign);
                }
            }
        };

        function addOrderToMap(sectorIndex) {
            var bounds = sectorPolygons[sectorIndex].geometry.getBounds();
            var xCenter = (bounds[0][0] + bounds[1][0]) / 2;
            var yCenter = (bounds[0][1] + bounds[1][1]) / 2;
            var orderPlacemark = new ymaps.Placemark([xCenter, yCenter], {
                hintContent: 'Заказ',
                balloonContent: 'Заказ'
            }, {
                preset: 'islands#blueIcon'
            });
            myMap.geoObjects.add(orderPlacemark);
        }

        function findLeastBusyCourier(sectorIndex) {
            return couriers.reduce((prev, current) => (prev.orders.length < current.orders.length) ? prev : current);
        }
    }
    </script>
</body>
</html>